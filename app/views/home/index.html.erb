<!-- Hero Section -->
<div class="py-16 relative overflow-hidden">
  <!-- Mumbai Skyline Background -->
  <div class="absolute bottom-0 left-1/2 transform -translate-x-1/2 w-full max-w-6xl pointer-events-none" style="bottom: 40px; opacity: 0.35;">
    <%= image_tag "mumbai-skyline-elongated.png", alt: "Mumbai Skyline", class: "w-full h-auto" %>
  </div>
  <div class="max-w-6xl mx-auto text-center px-4 relative z-10">
    <% if user_signed_in? %>
      <!-- Logged in user hero -->
      <div class="bg-white rounded-2xl shadow-lg p-8 mb-8 max-w-4xl mx-auto">
        <h1 class="font-display text-4xl mb-4 text-gray-800">
          Welcome back, <%= current_user.name&.split&.first || current_user.email&.split('@')&.first || 'Citizen' %>! <i class="fas fa-hand-wave"></i>
        </h1>
        <p class="text-xl mb-6 text-gray-600">
          Ready to continue making a difference in Mumbai's communities?
        </p>
        <% if @user_assignments&.any? %>
          <div class="bg-blue-50 rounded-lg p-4 mb-6">
            <p class="text-blue-800 font-semibold mb-2"><i class="fas fa-bullseye mr-2"></i>Your Active Contributions</p>
            <p class="text-blue-600 text-sm">
              You have <%= @user_assignments&.count || 0 %> active boundary mapping tasks across Mumbai's wards
            </p>
          </div>
        <% end %>
        <!-- Quick Actions for logged in users -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <% if @user_assignments&.any? %>
            <%= link_to ward_prabhag_path(@user_assignments.first.ward, @user_assignments.first),
                        class: "bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors" do %>
              <div class="text-sm opacity-90">Continue Mapping</div>
              <div class="font-bold">Prabhag <%= @user_assignments.first.number %></div>
            <% end %>
          <% end %>
          <%= link_to wards_path,
                      class: "bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors" do %>
            <div class="text-sm opacity-90">Explore</div>
            <div class="font-bold">All Communities</div>
          <% end %>
          <%= link_to "#",
                      class: "bg-gray-400 text-white font-semibold py-3 px-6 rounded-lg cursor-not-allowed" do %>
            <div class="text-sm opacity-90">Report</div>
            <div class="font-bold">Coming Soon</div>
          <% end %>
        </div>
      </div>
    <% else %>
      <!-- Non-logged in user hero -->
      <h1 class="font-display text-6xl mb-6 text-gray-800">
        MAKE REAL CHANGE<br>
        <span class="text-blue-600">IN YOUR WARD</span>
      </h1>
      <p class="text-2xl mb-8 text-gray-600 max-w-4xl mx-auto">
        Identify problems, organize solutions, execute projects, and track the impact you create
      </p>
      <!-- Ward Discovery Section -->
      <div class="bg-white rounded-2xl shadow-lg p-8 max-w-2xl mx-auto">
        <h2 class="text-2xl font-semibold mb-6 text-gray-800 flex items-center justify-center">
          <i class="fas fa-home mr-3"></i> Join Your Ward Community
        </h2>
        <div class="space-y-4">
          <%= link_to "Explore Communities", wards_path,
                      class: "w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-4 px-6 rounded-lg transition-colors inline-block text-center" %>
        </div>
      </div>
    <% end %>
    <!-- Progress Indicators (for all users) -->
    <div class="flex justify-center items-center space-x-8 mt-8 flex-wrap gap-4">
      <div class="flex items-center">
        <i class="fas fa-check-circle text-xl mr-2"></i>
        <span class="text-gray-700"><%= @active_communities %> Active Ward Communities</span>
      </div>
      <div class="flex items-center">
        <i class="fas fa-tools text-xl mr-2"></i>
        <span class="text-gray-700"><%= @total_issues_resolved %> Issues Resolved</span>
      </div>
      <div class="flex items-center">
        <i class="fas fa-calendar-alt text-xl mr-2"></i>
        <span class="text-gray-700"><%= @events_this_month %> Events This Month</span>
      </div>
    </div>
  </div>
</div>
<!-- Main Content Area -->
<div class="max-w-7xl mx-auto px-4 py-16">
  <!-- Location Setup Prompt -->
  <%= location_setup_banner %>
  <!-- User Location Summary -->
  <% if user_signed_in? && current_user.has_location? %>
    <div class="mb-8">
      <%= user_location_summary %>
    </div>
  <% end %>
  <!-- User's Current Activity (if logged in) -->
  <% if user_signed_in? %>
    <% if @user_assignments&.any? %>
      <div class="bg-yellow-50 border border-yellow-200 rounded-2xl p-8 mb-16">
        <h3 class="text-2xl font-semibold text-yellow-800 mb-6">Your Active Contributions</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <% (@user_assignments || []).limit(2).each do |assignment| %>
            <div class="bg-white p-4 rounded-lg border">
              <h4 class="font-semibold text-gray-800">Boundary Mapping</h4>
              <p class="text-sm text-gray-600 mb-2">Prabhag <%= assignment.number %> (Ward <%= assignment.ward_code %>)</p>
              <div class="flex justify-between items-center">
                <span class="text-xs px-2 py-1 rounded bg-yellow-100 text-yellow-800">In Progress</span>
                <%= link_to "Continue", prabhag_path(assignment),
                            class: "text-blue-600 hover:text-blue-800 text-sm" %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  <% end %>
  <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
    <!-- Community Impact -->
    <div class="bg-white p-8 rounded-2xl shadow-md">
      <h2 class="text-2xl font-semibold mb-6 text-gray-800 flex items-center">
        <i class="fas fa-chart-bar mr-3"></i> Community Impact
      </h2>
      <div class="space-y-4">
        <div class="flex justify-between">
          <span class="text-gray-600">Active Wards</span>
          <span class="font-semibold"><%= @active_communities %></span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600">Issues Resolved</span>
          <span class="font-semibold"><%= @total_issues_resolved %></span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600">Resolution Rate</span>
          <span class="font-semibold">
            <%= @total_issues_resolved > 0 ? "#{((@total_issues_resolved.to_f / (@total_issues_resolved + Ticket.where(status: ['open', 'assigned', 'in_progress']).count)) * 100).round}%" : '0%' %>
          </span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600">Citizens Engaged</span>
          <span class="font-semibold"><%= @total_citizens %></span>
        </div>
      </div>
    </div>
    <!-- Recent Activity -->
    <div class="bg-white p-8 rounded-2xl shadow-md">
      <h2 class="text-2xl font-semibold mb-6 text-gray-800 flex items-center">
        <i class="fas fa-bolt mr-3"></i>
        <% if user_signed_in? %>
          Your Recent Activity
        <% else %>
          Recent Activity
        <% end %>
      </h2>
      <div class="space-y-4">
        <% if user_signed_in? && @user_assignments&.any? %>
          <!-- Logged in user's personal activity -->
          <% (@user_assignments || []).limit(3).each do |assignment| %>
            <div class="border-l-4 border-purple-400 pl-3 py-2">
              <p class="text-sm font-medium text-gray-800">Your mapping: Prabhag <%= assignment.number %></p>
              <p class="text-xs text-gray-500">Ward <%= assignment.ward_code %> â€¢ In progress</p>
            </div>
          <% end %>
        <% elsif user_signed_in? %>
          <div class="text-center py-4 bg-blue-50 rounded-lg">
            <p class="text-blue-800 font-medium">Ready to get started?</p>
            <p class="text-sm text-blue-600 mt-2">Join a ward community to start mapping boundaries!</p>
          </div>
        <% else %>
          <div class="text-center py-4">
            <p class="text-gray-500">Community boundary mapping in progress</p>
            <p class="text-sm text-gray-400 mt-2">Issue reporting system coming soon!</p>
          </div>
        <% end %>
      </div>
    </div>
    <!-- How It Works -->
    <div class="bg-white p-8 rounded-2xl shadow-md">
      <h2 class="text-2xl font-semibold mb-6 text-gray-800 flex items-center">
        <i class="fas fa-lightbulb mr-3"></i> How It Works
      </h2>
      <div class="space-y-4">
        <div class="flex items-start space-x-3">
          <span class="flex-shrink-0 w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-bold">1</span>
          <p class="text-sm text-gray-600">Find your ward</p>
        </div>
        <div class="flex items-start space-x-3">
          <span class="flex-shrink-0 w-8 h-8 bg-green-100 text-green-600 rounded-full flex items-center justify-center text-sm font-bold">2</span>
          <p class="text-sm text-gray-600">Report issues</p>
        </div>
        <div class="flex items-start space-x-3">
          <span class="flex-shrink-0 w-8 h-8 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center text-sm font-bold">3</span>
          <p class="text-sm text-gray-600">Join events</p>
        </div>
        <div class="flex items-start space-x-3">
          <span class="flex-shrink-0 w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center text-sm font-bold">4</span>
          <p class="text-sm text-gray-600">Build change</p>
        </div>
      </div>
    </div>
  </div>
  <!-- Interactive Map Section -->
  <div class="bg-gray-50 rounded-2xl p-8 mb-16">
    <div class="text-center mb-8">
      <h2 class="text-3xl font-semibold mb-4 text-gray-800">Mumbai Ward Communities</h2>
      <div class="flex justify-center space-x-6 text-sm">
        <div class="flex items-center">
          <div class="w-4 h-4 bg-green-500 rounded-full mr-2"></div>
          <span class="text-gray-600"><i class="fas fa-circle mr-1"></i>Active</span>
        </div>
        <div class="flex items-center">
          <div class="w-4 h-4 bg-yellow-500 rounded-full mr-2"></div>
          <span class="text-gray-600"><i class="fas fa-circle mr-1"></i>Growing</span>
        </div>
        <div class="flex items-center">
          <div class="w-4 h-4 bg-gray-400 rounded-full mr-2"></div>
          <span class="text-gray-600"><i class="fas fa-circle mr-1"></i>Inactive</span>
        </div>
      </div>
    </div>
    <!-- Interactive Ward Map -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"
         data-controller="leaflet-map"
         data-leaflet-map-data-url-value="/wards.json"
         data-leaflet-map-show-labels-value="false"
         data-leaflet-map-show-legend-value="true"
         data-leaflet-map-static-value="true">
      <div data-leaflet-map-target="container"
           class="h-96 w-full relative desaturated-map">
        <!-- Map will be loaded here -->
      </div>
    </div>
    <div class="text-center mt-6 text-gray-600">
      <p class="mb-4">Help unlock inactive wards! Some communities need boundary mapping to get started.</p>
      <div class="space-x-4">
        <%= link_to "See Which Wards Need Help", wards_path,
                    class: "text-blue-600 hover:text-blue-800 underline" %>
        <span class="text-gray-400">|</span>
        <%= link_to "Learn About Mapping", prabhags_path,
                    class: "text-blue-600 hover:text-blue-800 underline" %>
      </div>
    </div>
  </div>
  <!-- Authentication Call-to-Action for non-logged in users -->
  <% unless user_signed_in? %>
    <div class="bg-white border border-gray-200 rounded-2xl p-8 text-center">
      <h2 class="text-3xl font-bold mb-4 text-gray-800">Ready to Make a Difference?</h2>
      <p class="text-xl mb-8 text-gray-600">Join thousands of Mumbai citizens building stronger communities</p>
      <div class="space-x-4">
        <%= button_to "Sign in with Google", user_google_oauth2_omniauth_authorize_path,
                      method: :post,
                      data: { turbo: false },
                      class: "bg-blue-600 text-white hover:bg-blue-700 font-bold py-3 px-8 rounded-lg border-0" %>
        <div class="mt-4 text-sm text-gray-500">
          <%= link_to "Sign In", new_user_session_path,
                      class: "text-blue-600 hover:text-blue-800 underline" %>
          |
          <%= link_to "Sign Up", new_user_registration_path,
                      class: "text-blue-600 hover:text-blue-800 underline" %>
        </div>
      </div>
    </div>
  <% end %>
</div>
